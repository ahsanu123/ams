import{n as t,a as f,t as G}from"./chunk-K6CSEXPM-Bn6mf80d.js";import"./query-client-B-np7aBl.js";import{c as M,b as $,p as h,d as A,g as J,e as b,A as T,u as V}from"./user-management-api-CbimgFC6.js";import{u as X}from"./QueryClientProvider-DhxQ09mG.js";import"./Toaster-D9QYH5nK.js";import{t as Z,f as F,F as C}from"./format-date-id-D-ORLjoU.js";import{i as q,a as v}from"./isSameDay-BShgF_mc.js";import{G as ee,B as S,u as ne,a as I,v as te,w as ae,x as re,j as se,y as ce}from"./index-NHkl8kqz.js";/* empty css                 */import{T as w,H as oe}from"./index-BGCzkhMS.js";import{C as O}from"./center-DefDiguQ.js";import{A as de,a as ie}from"./avatar-CMyZ4H7r.js";function le(n,e,a){const i=Z(n,a==null?void 0:a.in);return i.setDate(e),i}const ge=42;function N(n,e){const a=n.getFullYear(),i=n.getMonth();n.getDate();const B=new Date(a,i,1).getDay(),_=new Date(a,i+1,0).getDate(),D=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],y={totalDays:_},x=D[B],c=D.findIndex(l=>l===x),p=Array.from(Array(ge).keys()),j=l=>l<c||l>=c+y.totalDays,r=l=>l>0&&l<=y.totalDays,o=p.map(l=>{const R=l-c+1,k=le(n,R);return{type:j(l)?"HiddenDate":"ShowDate",date:k,product:r(R)&&e.length>0?e.find(m=>q(m.takenDate,k)):void 0}}),g=D.map(l=>({type:"HeaderLabel",headerLabelText:l}));return o.unshift(...g),o}const ue="/taking-record/add-new-taking-record",ye="/taking-record/add-new-taking-record-by-date",Re="/taking-record/get-taking-record-by-date",ke="/taking-record/get-taking-record-by-user-id",Te="/taking-record/get-taking-record-by-user-id-and-month-range",he="/taking-record/get-taking-record-by-user-id-and-date",me="/taking-record/get-taking-record-by-user-id-and-year",De="/taking-record/upsert-taking-record",xe="/taking-record/delete-taking-record-by-id",fe="/taking-record/get-taking-record-by-day",Ae="/taking-record/upsert-taking-record-by-date",Be={addNewTakingRecord:async function(n,e){const a=await h(`${T}${ue}`,{amount:e,userId:n});return b(a)},addNewTakingRecordByDate:async function(n,e,a){const i=await h(`${T}${ye}`,{amount:e,userId:n,date:a});return b(i)},getTakingRecordByUserId:async function(n){const e=await h(`${T}${ke}`,{userId:n});return A(e)},upsertTakingRecord:async function(n){const e=await h(`${T}${De}`,{record:n});return b(e)},getTakingRecordByMonth:async function(n){const e=await h(`${T}${Re}`,{date:n});return A(e)},getTakingRecordByUserIdAndMonth:async function(n,e){const a=await h(`${T}${he}`,{userId:n,date:e});return A(a)},getTakingRecordByUserIdAndRangeMonth:async function(n,e,a){const i=await h(`${T}${Te}`,{userId:n,from:e,to:a});return A(i)},getTakingRecordByUserIdAndYear:async function(n,e){const a=await h(`${T}${me}`,{userId:n,date:e});return A(a)},deleteTakingRecordById:async function(n){const e=await J(`${T}${xe}`,{takingRecordId:n});return A(e)},getTakingRecordByDay:async function(n){const e=await h(`${T}${fe}`,{date:n});return A(e)},upsertTakingRecordByDate:async function(n,e,a){const i=await h(`${T}${Ae}`,{amount:n,date:e,userId:a});return A(i)}},u=Be;function Fe(){const n=X(),e=M({onSuccess:()=>n.invalidateQueries({queryKey:["getTakingRecords"]}),mutationFn:({user_id:r,amount:o})=>u.addNewTakingRecord(r,o)}),a=M({onSuccess:()=>n.invalidateQueries({queryKey:["getTakingRecords","getTakingRecordByUserIdAndMonth"]}),mutationFn:({userId:r,amount:o,date:g})=>u.addNewTakingRecordByDate(r,o,g)});return{addNewtakingRecord:e,addNewTakingRecordByDate:a,getTakingRecordByUserId:r=>$({queryKey:["getTakingRecordByUserId"],queryFn:()=>u.getTakingRecordByUserId(r)}),upsertTakingRecord:r=>M({onSuccess:()=>n.invalidateQueries({queryKey:["getTakingRecords"]}),mutationFn:()=>u.upsertTakingRecord(r)}),upsertTakingRecordByDate:(r,o,g)=>M({onSuccess:()=>n.invalidateQueries({queryKey:["getTakingRecords"]}),mutationFn:()=>u.upsertTakingRecordByDate(r,o,g)}),getTakingRecordByMonth:r=>$({queryKey:["getTakingRecordByMonth "],queryFn:()=>u.getTakingRecordByMonth(r)}),getTakingRecordByUserIdAndMonth:(r,o)=>({queryKey:["getTakingRecordByUserIdAndMonth",r],queryFn:()=>u.getTakingRecordByUserIdAndMonth(r,o),enabled:!!r}),getTakingRecordByUserIdAndYear:(r,o)=>({queryKey:["getTakingRecordByUserIdAndYear",r,o],queryFn:()=>u.getTakingRecordByUserIdAndYear(r,o),enabled:!!r&&!!o}),getTakingRecordByUserIdAndRangeMonth:(r,o,g)=>({queryKey:["getTakingRecordByUserIdAndRangeMonth",r,o,g],queryFn:()=>u.getTakingRecordByUserIdAndRangeMonth(r,o,g),enabled:!!r&&!!o&&!!g}),deleteTakingRecordById:r=>M({onSuccess:()=>n.invalidateQueries({queryKey:["getTakingRecords"]}),mutationFn:()=>u.deleteTakingRecordById(r)}),getTakingRecordByDay:r=>$({queryKey:["getTakingRecordByDay"],queryFn:()=>u.getTakingRecordByDay(r)})}}function _e(n){return ee({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32 32C14.3 32 0 46.3 0 64L0 448c0 17.7 14.3 32 32 32s32-14.3 32-32l0-181.7L149.2 96 64 96l0-32c0-17.7-14.3-32-32-32zM405.2 96l-74.3 0-5.4 10.7L234.8 288l74.3 0 5.4-10.7L405.2 96zM362.8 288l74.3 0 5.4-10.7L533.2 96l-74.3 0-5.4 10.7L362.8 288zM202.8 96l-5.4 10.7L106.8 288l74.3 0 5.4-10.7L277.2 96l-74.3 0zm288 192l85.2 0 0 160c0 17.7 14.3 32 32 32s32-14.3 32-32l0-384c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 53.7L490.8 288z"},child:[]}]})(n)}function pe(n){const{data:e,onCellClicked:a,isAdmin:i=!1}=n,B=e.date&&q(e.date,new Date),_=()=>t.jsx(w,{fontWeight:"bold",children:e.headerLabelText}),D=()=>{var x;return t.jsx(t.Fragment,{children:e.product?t.jsxs(S,{onClick:()=>i&&(a==null?void 0:a(e.date)),className:`calendar-cell ${B?"highlight-current-day":""} ${i?"is-admin":""}`,children:[t.jsx(O,{className:"current-day",children:t.jsx(w,{children:e.date&&F(e.date,"dd")})}),t.jsx(O,{className:"taking-amount",children:t.jsx(w,{textDecor:e.product.isPaid?"line-through":"",textStyle:"6xl",fontWeight:"bold",children:(x=e.product)==null?void 0:x.amount})})]}):t.jsx(S,{onClick:()=>i&&(a==null?void 0:a(e.date)),className:`calendar-cell ${B?"highlight-current-day":""} ${i?"is-admin":""}`,children:t.jsx(O,{className:"current-day",children:t.jsx(w,{children:e.date&&F(e.date,"dd")})})})})},y=()=>t.jsx(O,{alignItems:"center",className:"calendar-cell stripe",children:t.jsx(_e,{size:"40px"})});switch(e.type){case"HeaderLabel":return _();case"ShowDate":return D();case"HiddenDate":return y();default:return t.jsx(t.Fragment,{})}}function Le(n){const{takingRecords:e,user:a,isAdmin:i=!1,customerMode:B=!1,showNavigator:_=!1,hideCustomerAvatar:D=!1,month:y,title:x,onCustomerIdChange:c,onPrevMonthClicked:p,onNextMonthClicked:j,onCellClicked:r}=n,[o,g]=f.useState(N(new Date,e??[])),[l,R]=f.useState(new Date),[k,L]=f.useState([]),[m,E]=f.useState(a),[U,K]=f.useState(e??[]),Y=()=>{const s=new Date;R==null||R(s),g(N(s,U))},H=()=>{const s=v(l,-1);R==null||R(s),g(N(s,U)),p==null||p(s)},z=()=>{const s=v(l,1);R(s),g(N(s,U)),j==null||j(s)},P=()=>{if(m===void 0)return;let s=k.findIndex(d=>d.id===m.id);if(s<=0){const d=k[k.length-1];E(d),c==null||c(d.id)}else{const d=k[s-1];E(d),c==null||c(d.id)}},Q=()=>{if(m===void 0)return;let s=k.findIndex(d=>d.id===m.id);if(s>=k.length-1){const d=k[0];E(d),c==null||c(d.id)}else{const d=k[s+1];E(d),c==null||c(d.id)}};f.useEffect(()=>{g(N(new Date,e??[])),e&&K(e)},[e]),f.useEffect(()=>{V.getAllActiveUser().then(s=>{if(L(s),s.length>0&&a===void 0){const d=s[0];E(d),c==null||c(d.id)}})},[]),f.useEffect(()=>{E(a),a&&(c==null||c(a.id)),a&&y&&(R(y),u.getTakingRecordByUserIdAndMonth(a.id,y).then(s=>{K(s),g(N(y,s))}))},[a,y]);const W=`${F(l,"MMMM yyyy")} 
                      ${x?` - ${x}`:""}`;return t.jsxs(S,{className:"calendar",children:[t.jsxs(C,{className:"calendar-flex",children:[t.jsx(oe,{minWidth:250,size:"2xl",children:t.jsxs(C,{alignItems:"center",gap:"15px",children:[t.jsx(ne,{size:"36px",color:"orange"}),W]})}),_&&t.jsxs(C,{className:"calendar-navigation",children:[t.jsxs(I,{onClick:()=>Y(),children:[t.jsx(te,{}),"Bulan Ini"]}),t.jsxs(I,{onClick:()=>H(),children:[t.jsx(ae,{}),"Bulan Lalu"]}),t.jsxs(I,{onClick:()=>z(),children:[t.jsx(re,{}),"Bulan Depan"]})]}),B&&t.jsxs(C,{gap:5,children:[t.jsxs(I,{onClick:()=>P(),children:[t.jsx(se,{}),"Sebelumnya"]}),t.jsxs(I,{onClick:()=>Q(),children:["Selanjutnya",t.jsx(ce,{})]})]}),m&&!D&&t.jsxs(G.Fragment,{children:[t.jsx(de,{children:t.jsx(ie,{name:m.username})}),t.jsx(w,{textStyle:"4xl",fontWeight:"bold",children:m.username})]})]}),t.jsx(S,{className:"ams-calendar",children:o&&o.map((s,d)=>t.jsx(G.Fragment,{children:t.jsx(pe,{data:s,onCellClicked:r,isAdmin:i})},d))})]})}export{Le as C,u as t,Fe as u};
