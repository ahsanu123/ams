import{g as Z,e as je,S as $}from"./stack-CD8du1Wu.js";import{a as p,n as t,t as Te}from"./chunk-K6CSEXPM-Bn6mf80d.js";import"./query-client-B-np7aBl.js";import{C as Re,t as B}from"./Calendar-C7hCejGk.js";import{u as ke}from"./user-management-api-CbimgFC6.js";import{S as we,T as Ie,a as ye,b as X,c as U,d as Ae,e as V,D as Ne,B as De}from"./Scroller-vb5K4257.js";import{V as q}from"./VirtualKeypad-BNjNZjnh.js";import{ag as W,ah as x,ai as S,e as be,aD as Ee,aA as P,c as $e,aE as Be,aF as Oe,a as Fe,al as Le,ak as Me,am as Ue,an as Ve,ab as Q,ao as He,ae as Ke,aa as y}from"./Toaster-D9QYH5nK.js";import{d as We}from"./DataListUtil-DLK3g0eA.js";import{F as O,f as A}from"./format-date-id-D-ORLjoU.js";import{k as _e,l as Ge,r as Je,B as Xe,a as H,s as qe,t as ze}from"./index-NHkl8kqz.js";import{G as Ze}from"./index-BLpYadyO.js";import{T as K}from"./index-BGCzkhMS.js";import{D as Qe,a as Ye,b as et,c as tt,d as rt,e as st,f as ot,g as nt,h as at,u as it,C as dt}from"./close-button-UJZd7FY4.js";import{c as F}from"./create-split-props-u5h9OPvL.js";import{A as ct,a as lt}from"./avatar-CMyZ4H7r.js";import"./QueryClientProvider-DhxQ09mG.js";import"./isSameDay-BShgF_mc.js";/* empty css                 */import"./center-DefDiguQ.js";import"./Scroller-BcfPVuNP.js";/* empty css                      */import"./index-BmMpWGiz.js";import"./render-strategy-DveMVg2c.js";import"./index-GjkUTHr-.js";import"./index-DlDWRYrk.js";const[Y,T]=W({name:"StepsContext",hookName:"useStepsContext",providerName:"<StepsProvider />"}),ee=p.forwardRef((e,r)=>{const s=T(),n=x(s.getContentProps({index:s.count}),e);return t.jsx(S.div,{...n,ref:r})});ee.displayName="StepsCompletedContent";const te=p.forwardRef((e,r)=>{const[s,n]=F()(e,["index"]),a=T(),i=x(a.getContentProps(s),n);return t.jsx(S.div,{...i,ref:r})});te.displayName="StepsContent";const[pt,_]=W({name:"StepsItemPropsContext",hookName:"useStepsItemPropsContext",providerName:"<StepsItemPropsProvider />"}),re=p.forwardRef((e,r)=>{const s=T(),n=_(),a=x(s.getIndicatorProps(n),e);return t.jsx(S.div,{...a,ref:r})});re.displayName="StepsIndicator";const[ut,gt]=W({name:"StepsItemContext",hookName:"useStepsItemContext",providerName:"<StepsItem />"}),se=p.forwardRef((e,r)=>{const[s,n]=F()(e,["index"]),a=T(),i=x(a.getItemProps(s),n),h=a.getItemState(s);return t.jsx(pt,{value:s,children:t.jsx(ut,{value:h,children:t.jsx(S.div,{...i,ref:r})})})});se.displayName="StepsItem";const G=e=>e.children(gt());G.displayName="StepsItemContext";const oe=p.forwardRef((e,r)=>{const s=T(),n=x(s.getListProps(),e);return t.jsx(S.div,{...n,ref:r})});oe.displayName="StepsList";const ne=p.forwardRef((e,r)=>{const s=T(),n=x(s.getNextTriggerProps(),e);return t.jsx(S.button,{...n,ref:r})});ne.displayName="StepsNextTrigger";const ae=p.forwardRef((e,r)=>{const s=T(),n=x(s.getPrevTriggerProps(),e);return t.jsx(S.button,{...n,ref:r})});ae.displayName="StepsPrevTrigger";var mt=$e("steps").parts("root","list","item","trigger","indicator","separator","content","nextTrigger","prevTrigger","progress"),C=mt.build(),ht=e=>{var r;return((r=e.ids)==null?void 0:r.root)??`steps:${e.id}`},xt=e=>{var r;return((r=e.ids)==null?void 0:r.list)??`steps:${e.id}:list`},z=(e,r)=>{var s,n;return((n=(s=e.ids)==null?void 0:s.triggerId)==null?void 0:n.call(s,r))??`steps:${e.id}:trigger:${r}`},St=(e,r)=>{var s,n;return((n=(s=e.ids)==null?void 0:s.contentId)==null?void 0:n.call(s,r))??`steps:${e.id}:content:${r}`};function ft(e,r){const{context:s,send:n,computed:a,prop:i,scope:h}=e,R=s.get("step"),g=i("count"),j=a("percent"),N=a("hasNextStep"),k=a("hasPrevStep"),u=d=>({triggerId:z(h,d.index),contentId:St(h,d.index),current:d.index===R,completed:d.index<R,incomplete:d.index>R,index:d.index,first:d.index===0,last:d.index===g-1}),w=()=>{n({type:"STEP.NEXT",src:"next.trigger.click"})},D=()=>{n({type:"STEP.PREV",src:"prev.trigger.click"})},b=()=>{n({type:"STEP.RESET",src:"reset.trigger.click"})},L=d=>{n({type:"STEP.SET",value:d,src:"api.setValue"})};return{value:R,count:g,percent:j,hasNextStep:N,hasPrevStep:k,isCompleted:a("completed"),goToNextStep:w,goToPrevStep:D,resetStep:b,getItemState:u,setStep:L,getRootProps(){return r.element({...C.root.attrs,id:ht(h),dir:i("dir"),"data-orientation":i("orientation"),style:{"--percent":`${j}%`}})},getListProps(){const l=Be(g).map((E,I)=>z(h,I));return r.element({...C.list.attrs,dir:i("dir"),id:xt(h),role:"tablist","aria-owns":l.join(" "),"aria-orientation":i("orientation"),"data-orientation":i("orientation")})},getItemProps(d){const l=u(d);return r.element({...C.item.attrs,dir:i("dir"),"aria-current":l.current?"step":void 0,"data-orientation":i("orientation")})},getTriggerProps(d){const l=u(d);return r.button({...C.trigger.attrs,id:l.triggerId,role:"tab",dir:i("dir"),tabIndex:!i("linear")||l.current?0:-1,"aria-selected":l.current,"aria-controls":l.contentId,"data-state":l.current?"open":"closed","data-orientation":i("orientation"),"data-complete":P(l.completed),"data-current":P(l.current),"data-incomplete":P(l.incomplete),onClick(E){E.defaultPrevented||i("linear")||n({type:"STEP.SET",value:d.index,src:"trigger.click"})}})},getContentProps(d){const l=u(d);return r.element({...C.content.attrs,dir:i("dir"),id:l.contentId,role:"tabpanel",tabIndex:0,hidden:!l.current,"data-state":l.current?"open":"closed","data-orientation":i("orientation"),"aria-labelledby":l.triggerId})},getIndicatorProps(d){const l=u(d);return r.element({...C.indicator.attrs,dir:i("dir"),"aria-hidden":!0,"data-complete":P(l.completed),"data-current":P(l.current),"data-incomplete":P(l.incomplete)})},getSeparatorProps(d){const l=u(d);return r.element({...C.separator.attrs,dir:i("dir"),"data-orientation":i("orientation"),"data-complete":P(l.completed),"data-current":P(l.current),"data-incomplete":P(l.incomplete)})},getNextTriggerProps(){return r.button({...C.nextTrigger.attrs,dir:i("dir"),type:"button",disabled:!N,onClick(d){d.defaultPrevented||w()}})},getPrevTriggerProps(){return r.button({dir:i("dir"),...C.prevTrigger.attrs,type:"button",disabled:!k,onClick(d){d.defaultPrevented||D()}})},getProgressProps(){return r.element({dir:i("dir"),...C.progress.attrs,role:"progressbar","aria-valuenow":j,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":`${j}% complete`,"data-complete":P(j===100)})}}}var Pt=be({props({props:e}){return{defaultStep:0,count:1,linear:!1,orientation:"horizontal",...e}},context({prop:e,bindable:r}){return{step:r(()=>({defaultValue:e("defaultStep"),value:e("step"),onChange(s){var a,i;(a=e("onStepChange"))==null||a({step:s}),s==e("count")&&((i=e("onStepComplete"))==null||i())}}))}},computed:{percent:Ee(({context:e,prop:r})=>[e.get("step"),r("count")],([e,r])=>e/r*100),hasNextStep:({context:e,prop:r})=>e.get("step")<r("count"),hasPrevStep:({context:e})=>e.get("step")>0,completed:({context:e,prop:r})=>e.get("step")===r("count")},initialState(){return"idle"},entry:["validateStep"],states:{idle:{on:{"STEP.SET":{actions:["setStep"]},"STEP.NEXT":{actions:["goToNextStep"]},"STEP.PREV":{actions:["goToPrevStep"]},"STEP.RESET":{actions:["resetStep"]}}}},implementations:{actions:{goToNextStep({context:e,prop:r}){const s=Math.min(e.get("step")+1,r("count"));e.set("step",s)},goToPrevStep({context:e}){const r=Math.max(e.get("step")-1,0);e.set("step",r)},resetStep({context:e}){e.set("step",0)},setStep({context:e,event:r}){e.set("step",r.value)},validateStep({context:e,prop:r}){Ct(r("count"),e.get("step"))}}}}),Ct=(e,r)=>{if(!Oe(r,0,e))throw new RangeError(`[zag-js/steps] step index ${r} is out of bounds`)};Fe()(["count","dir","getRootNode","id","ids","linear","onStepChange","onStepComplete","orientation","step","defaultStep"]);function vt(e){const r=p.useId(),{getRootNode:s}=Le(),{dir:n}=Me(),a={id:r,dir:n,getRootNode:s,...e},i=Ue(Pt,a);return ft(i,Ve)}const ie=p.forwardRef((e,r)=>{const[s,n]=F()(e,["defaultStep","id","ids","count","linear","onStepChange","onStepComplete","orientation","step"]),a=vt(s),i=x(a.getRootProps(),n);return t.jsx(Y,{value:a,children:t.jsx(S.div,{...i,ref:r})})});ie.displayName="StepsRoot";const de=p.forwardRef((e,r)=>{const[{value:s},n]=F()(e,["value"]),a=x(s.getRootProps(),n);return t.jsx(Y,{value:s,children:t.jsx(S.div,{...a,ref:r,children:e.children})})});de.displayName="StepsRootProvider";const ce=p.forwardRef((e,r)=>{const s=T(),n=_(),a=x(s.getSeparatorProps(n),e);return t.jsx(S.div,{...a,ref:r})});ce.displayName="StepsSeparator";const le=p.forwardRef((e,r)=>{const s=T(),n=_(),a=x(s.getTriggerProps(n),e);return t.jsx(S.button,{...a,ref:r})});le.displayName="StepsTrigger";const{withRootProvider:pe,withContext:v}=Q({key:"drawer"});pe(ot,{defaultProps:{unmountOnExit:!0,lazyMount:!0}});const jt=pe(Qe,{defaultProps:{unmountOnExit:!0,lazyMount:!0}});v(nt,"trigger",{forwardAsChild:!0});const Tt=v(et,"positioner",{forwardAsChild:!0}),Rt=v(tt,"content",{forwardAsChild:!0});v(at,"description",{forwardAsChild:!0});const kt=v(rt,"title",{forwardAsChild:!0}),wt=v(st,"closeTrigger",{forwardAsChild:!0});p.forwardRef(function(r,s){const n=it();return t.jsx(Z.button,{...r,ref:s,onClick:()=>n.setOpen(!1)})});const It=v(Ye,"backdrop",{forwardAsChild:!0}),yt=v("div","body");v("div","footer");const At=v("div","header"),{withProvider:ue,withContext:f}=Q({key:"steps"});ue(de,"root",{forwardAsChild:!0});const Nt=ue(ie,"root",{forwardAsChild:!0}),Dt=f(oe,"list",{forwardAsChild:!0}),bt=f(se,"item",{forwardAsChild:!0});f(le,"trigger",{forwardAsChild:!0});const Et=f(te,"content",{forwardAsChild:!0}),$t=f(ee,"content"),Bt=p.forwardRef(function(r,s){return t.jsx(G,{children:n=>t.jsx(Z.div,{ref:s,...r,children:n.index+1})})}),Ot=f("div","title");f("div","description");const Ft=f(ce,"separator",{forwardAsChild:!0}),Lt=e=>t.jsx(G,{children:r=>r.current?t.jsx(t.Fragment,{children:e.current??e.incomplete}):r.completed?t.jsx(t.Fragment,{children:e.complete}):t.jsx(t.Fragment,{children:e.incomplete??e.current})}),Mt=f(re,"indicator",{forwardAsChild:!0,defaultProps:{children:t.jsx(Lt,{complete:t.jsx(He,{}),incomplete:t.jsx(Bt,{})})}});f(ne,"nextTrigger",{forwardAsChild:!0});f(ae,"prevTrigger",{forwardAsChild:!0});const m=_e()(Ge((e,r)=>({isAddingNewRecord:!1,setIsAddingAddNewRecord:s=>{e(n=>{n.isAddingNewRecord=s})},customers:[],setCustomers:s=>{e(n=>{n.customers=s})},selectedDate:void 0,setSelectedDate:s=>{e(n=>{n.selectedDate=s})},takingRecords:[],setTakingRecord:s=>{e(n=>{n.takingRecords=s})},selectedTakingRecord:void 0,setSelectedTakingRecord:s=>{e(n=>{n.selectedTakingRecord=s})},selectedCustomer:void 0,setSelectedCustomer:s=>{e(n=>{n.selectedCustomer=s})}})));async function ur(){return{activeCustomer:await ke.getAllActiveUser()}}async function gr(){}const mr=je(function({loaderData:r}){const s=m(o=>o.customers),n=m(o=>o.setCustomers),a=m(o=>o.selectedDate),i=m(o=>o.setSelectedDate),h=m(o=>o.takingRecords),R=m(o=>o.setTakingRecord),g=m(o=>o.selectedTakingRecord),j=m(o=>o.setSelectedTakingRecord),N=m(o=>o.isAddingNewRecord),k=m(o=>o.setIsAddingAddNewRecord),u=m(o=>o.selectedCustomer),w=m(o=>o.setSelectedCustomer),[D,b]=p.useState(!1),[L,d]=p.useState(0),l=[{title:"Pilih Pelanggan",description:"Klik Edit atau Add pada Table di sebelah kanan."},{title:"Masukan Jumlah",description:"Masukan Jumlah Ampas"}],E=o=>{b(!0),i(o)},I=o=>{o&&B.getTakingRecordByDay(o).then(c=>R(c))},ge=o=>{const c=s.find(M=>M.id===o.userId);if(!c){y.create({title:`Customer With ID=${o.userId} is not found `,type:"error"});return}d(1),w(c),j(o)},me=o=>{B.deleteTakingRecordById(o.id).then(c=>{y.create({title:"Data Deleted",type:"success"}),I(a)})},he=o=>{g&&B.upsertTakingRecord({...g,amount:o}).then(c=>{y.create({title:`Success Updating, ${o}`,type:"success"}),d(0),j(void 0),I(a)}).catch(c=>{y.create({title:`Success Updating, ${c}`,type:"error"})})},xe=(o,c)=>{!u||!a||B.addNewTakingRecordByDate(u.id,o,a).then(()=>{y.create({title:`${u.username} Pick ${o} Ampas`,type:"success"}),d(0),k(!1),c(),I(a)}).catch(M=>{y.create({title:`Success Updating, ${M}`,type:"error"}),c()})},J=o=>{if(o==0)return"Tidak Boleh Nol (0)"},Se=()=>{R([]),w(void 0),i(void 0),j(void 0),k(!1)},fe=o=>{d(1),w(o),k(!0)},Pe=()=>t.jsx(t.Fragment,{children:N?t.jsx(q,{title:"Tambahkan Record",defaultValue:0,handleOnConfirm:xe,validatorFunction:J}):t.jsx(q,{title:g?`${u==null?void 0:u.username} - ${A(g.takenDate)}`:"Klik edit pada data",description:g?`Klik Ok Untuk update data ${u==null?void 0:u.username} hari ${A(g.takenDate)}`:"",defaultValue:g?g.amount:0,disabled:g===void 0,handleOnConfirm:he,validatorFunction:J})});p.useEffect(()=>{n(r.activeCustomer)},[]),p.useEffect(()=>{I(a)},[a]);const Ce=()=>t.jsx($,{children:a&&t.jsxs(O,{children:[t.jsxs($,{minWidth:"400px",children:[Pe(),t.jsxs(Nt,{step:L,onStepChange:o=>d(o.step),size:"sm",defaultStep:1,count:l.length,children:[t.jsx(Dt,{children:l.map((o,c)=>t.jsxs(bt,{index:c,title:o.title,children:[t.jsx(Mt,{}),t.jsx(Ot,{children:o.title}),t.jsx(Ft,{})]},c))}),l.map((o,c)=>t.jsx(Et,{index:c,children:o.description},c)),t.jsx($t,{children:"All steps are complete!"})]})]}),t.jsx(Xe,{width:"100%",children:t.jsx(we,{minHeight:"85vh",children:t.jsx($,{children:t.jsxs(Ie,{striped:!0,stickyHeader:!0,strokeLinecap:"round",size:"lg",variant:"line",children:[t.jsx(ye,{children:t.jsxs(X,{children:[t.jsx(U,{children:"Username"}),t.jsx(U,{children:"Date"}),t.jsx(U,{children:"Record"})]})}),t.jsx(Ae,{children:s.map(o=>t.jsxs(X,{children:[t.jsx(V,{children:t.jsxs(O,{alignItems:"center",gap:3,children:[t.jsx(ct,{children:t.jsx(lt,{name:o.username})}),t.jsx(K,{textStyle:"xl",children:o.username})]})}),t.jsx(V,{children:t.jsx(K,{textStyle:"xl",children:A(a)})}),t.jsx(V,{children:t.jsxs(Ne,{orientation:"horizontal",children:[h.length>0&&h.filter(c=>c.userId===o.id).map(c=>t.jsxs(Te.Fragment,{children:[We(A(c.takenDate,"HH:mm"),`${c.amount} Ampas`,c.isPaid?t.jsx(De,{colorPalette:"green",children:"Terbayar"}):void 0),t.jsxs(O,{gap:5,children:[t.jsxs(H,{disabled:c.isPaid,onClick:()=>ge(c),maxWidth:"200px",children:[t.jsx(qe,{}),"Edit"]}),t.jsxs(H,{disabled:c.isPaid,onClick:()=>me(c),colorPalette:"red",children:[t.jsx(Ze,{}),"Delete"]})]})]},c.id)),!h.map(c=>c.userId).includes(o.id)&&t.jsxs(H,{maxWidth:"200px",onClick:()=>fe(o),children:[t.jsx(ze,{}),"Add Record"]})]})})]},o.id))})]})})})})]})}),ve=()=>t.jsx(jt,{size:"full",open:D,onOpenChange:o=>b(o.open),children:t.jsxs(Ke,{children:[t.jsx(It,{}),t.jsx(Tt,{children:t.jsxs(Rt,{children:[t.jsx(At,{children:t.jsx(kt,{children:a?t.jsxs(O,{alignItems:"center",gap:4,children:[t.jsx(Je,{}),t.jsx(K,{textStyle:"lg",children:A(a)})]}):null})}),t.jsx(yt,{children:Ce()}),t.jsx(wt,{onClick:Se,asChild:!0,children:t.jsx(dt,{size:"2xl"})})]})})]})});return t.jsxs($,{children:[t.jsx(Re,{isAdmin:!0,showNavigator:!0,hideCustomerAvatar:!0,onCellClicked:E}),ve()]})});export{gr as clientAction,ur as clientLoader,mr as default};
