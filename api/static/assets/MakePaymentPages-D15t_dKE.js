import{S as v,e as Ue}from"./stack-CD8du1Wu.js";import{a as y,n as e,t as te}from"./chunk-K6CSEXPM-Bn6mf80d.js";import{u as Ve,T as ne,a as se,b as I,c as A}from"./dreg-price-api-CE6ObdYP.js";import{E as _e}from"./header-information-contant-B3N2sSri.js";import"./query-client-B-np7aBl.js";import{c as We,p as ie,d as re,A as le,a as qe,b as F,u as Qe}from"./user-management-api-CbimgFC6.js";import{u as Ge,C as oe}from"./Calendar-C7hCejGk.js";import{u as Je}from"./QueryClientProvider-DhxQ09mG.js";import{D as O,S as z,T as ce,a as de,b as H,c as b,d as he,e as C,f as Xe,g as Ze,h as ea,B as _}from"./Scroller-vb5K4257.js";import{u as aa}from"./main-layout-state-74XbQ8nQ.js";import{af as ta,ae as na}from"./Toaster-D9QYH5nK.js";import{t as me,n as sa,c as ia,f as m,F as P,a as ra,i as ue}from"./format-date-id-D-ORLjoU.js";import{f as j,C as W,a as R,b as B,c as xe}from"./format-as-rupiah-C_Lq9mCl.js";import{r as la,c as oa,s as ca,S as da,a as ha,b as ma,d as ua,e as xa,f as ja,g as ga,h as fa,i as pa,D as q,j as Q}from"./index.es-BK2oozlO.js";import{k as ya,l as Ma,B as M,o as G,p as ka,q as Ta,a as je}from"./index-NHkl8kqz.js";import{C as Da}from"./center-DefDiguQ.js";import{H as u,T as k}from"./index-BGCzkhMS.js";import{A as Pa,a as Sa}from"./avatar-CMyZ4H7r.js";import"./create-split-props-u5h9OPvL.js";import"./render-strategy-DveMVg2c.js";import"./Scroller-BcfPVuNP.js";import"./isSameDay-BShgF_mc.js";/* empty css                 */import"./index-BmMpWGiz.js";import"./index-COO_Jjqm.js";import"./index-DlDWRYrk.js";const fe=y.forwardRef(function(c,n){return e.jsx(v,{align:"center",...c,direction:"column",ref:n})});fe.displayName="VStack";function ba(o,c){const n=+me(o)-+me(c);return n<0?-1:n>0?1:n}function Ca(o,c){const[n,r]=sa(o,c.start,c.end);return{start:n,end:r}}function ge(o,c){const{start:n,end:r}=Ca(c==null?void 0:c.in,o);let g=+n>+r;const N=g?+n:+r,T=g?r:n;T.setHours(0,0,0,0),T.setDate(1);let $=1;const S=[];for(;+T<=N;)S.push(ia(n,T)),T.setMonth(T.getMonth()+$);return g?S.reverse():S}const Ra="/make-payment-page/get-page-model",va="/make-payment-page/make-payment",Ia={getPageModel:async function(o,c){const n=await ie(`${le}${Ra}`,{userId:o,date:c});return re(n)},makePayment:async function(o,c){const n=await ie(`${le}${va}`,{userId:o,date:c});return re(n)}},J=Ia;function Aa(){const o=Je(),c=(r,g)=>({queryKey:["getPageModel",r,g],queryFn:()=>J.getPageModel(r,g),enabled:!!r&&!!g}),n=We({onSuccess:()=>o.invalidateQueries({queryKey:["getPageModel"]}),mutationFn:({userId:r,date:g})=>J.makePayment(r,g)});return{getPageModel:c,makePayment:n}}const w=ya()(Ma((o,c)=>({pageModel:void 0,setPageModel:n=>{o(r=>{r.pageModel=n})},showDetailTaking:!1,setShowDetailTaking:n=>{o(r=>{r.showDetailTaking=n})},oneYearRecords:[],setOneYearRecrods:n=>{o(r=>{r.oneYearRecords=n})},selectedDate:void 0,setSelectedDate:n=>{o(r=>{r.selectedDate=n})},selectedCustomer:void 0,setSelectedCustomer:n=>{o(r=>{r.selectedCustomer=n})},listCustomer:[],setListCustomer:n=>{o(r=>{r.listCustomer=n})},dateSelectorEnabled:!1}))),st=Ue(function(){la("id",ue);const{getAllActiveUser:c}=qe(),{getPageModel:n,makePayment:r}=Aa(),{getAllDregPrice:g}=Ve(),{getTakingRecordByUserIdAndRangeMonth:N,getTakingRecordByUserIdAndYear:T}=Ge(),$=aa(a=>a.setHeaderInformation),{data:S}=F(c()),s=w(a=>a.selectedCustomer),X=w(a=>a.setSelectedCustomer),d=w(a=>a.selectedDate),pe=w(a=>a.setSelectedDate),Z=w(a=>a.showDetailTaking),ee=w(a=>a.setShowDetailTaking),[f,ye]=y.useState(void 0),[p,Me]=y.useState(void 0),[ke,E]=y.useState(!1),[Te,L]=y.useState(!1),[De,Y]=y.useState(!1),[Pe,Se]=y.useState("Kalender"),{data:l,refetch:be}=F(n(s==null?void 0:s.id,d)),{data:K}=F(T(s==null?void 0:s.id,d)),{data:h,refetch:Ce}=F(N(s==null?void 0:s.id,f,p)),{data:U}=F(g());if(y.useEffect(()=>($({title:"Make Payment Page",description:"place for customer to pay bill"}),()=>$(_e)),[]),y.useEffect(()=>{(s===void 0||d===void 0)&&ee(!1)},[s,d]),y.useEffect(()=>{l&&ee(!0)},[l]),!S||!U)return e.jsx(Da,{children:e.jsxs(fe,{children:[e.jsx(ta,{size:"xl"}),e.jsx(u,{children:"Loading..."}),l?"":"pageModel is undefined"]})});const ae=oa({items:S.map(a=>({label:a.username,value:a.id.toString()}))}),Re=Array.from({length:12},(a,t)=>t).map(a=>ca(new Date,a)),ve=a=>{if(a){const t=Date.UTC(a.getFullYear(),a.getMonth(),1);pe(new Date(t)),E(!1)}},Ie=a=>{if(a){const t=Date.UTC(a.getFullYear(),a.getMonth(),1);ye(new Date(t)),L(!1)}},Ae=a=>{if(a){const t=Date.UTC(a.getFullYear(),a.getMonth(),1);Me(new Date(t)),Y(!1)}},Be=()=>{!s||!d||r.mutate({userId:s.id,date:d})},we=()=>{if(!(f&&p&&h))return;const a=ge({start:f,end:p});return e.jsx(v,{maxWidth:"900px",children:e.jsxs(ne,{orientation:"vertical",defaultValue:m(f,"MMMM"),children:[e.jsx(se,{children:a.map(t=>e.jsx(I,{value:m(t,"MMMM"),children:m(t,"MMMM")}))}),a.map(t=>e.jsx(A,{value:m(t,"MMMM"),children:e.jsx(z,{children:e.jsxs(ce,{striped:!0,stickyHeader:!0,strokeLinecap:"round",size:"lg",variant:"line",children:[e.jsx(de,{children:e.jsxs(H,{children:[e.jsx(b,{children:"Jumlah"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Tanggal"})]})}),e.jsxs(he,{children:["Total"," ",h.recordWithPrice.filter(i=>Q(i.takingRecord.takenDate,t)).map(i=>i.takingRecord.amount).reduce((i,D)=>i+D,0)," "," | "," ",j(h.recordWithPrice.filter(i=>Q(i.takingRecord.takenDate,t)).map(i=>i.takingRecord.amount*i.price.price).reduce((i,D)=>i+D,0)),h.recordWithPrice.filter(i=>Q(i.takingRecord.takenDate,t)).sort((i,D)=>ba(i.takingRecord.takenDate,D.takingRecord.takenDate)).map(i=>e.jsxs(H,{children:[e.jsx(C,{children:i.takingRecord.amount}),e.jsxs(C,{children:[e.jsx(k,{children:j(i.price.price)}),i.takingRecord.isPaid&&e.jsx(_,{colorPalette:"green",children:"Lunas"})]}),e.jsx(C,{children:m(i.takingRecord.takenDate)})]}))]})]})})}))]})})},Fe=async()=>{if(!f||!p||!s)return;const a=ge({start:f,end:p});for(const i of a)await J.makePayment(s.id,i);await Ce(),await be();const t=await Qe.getById(s.id);X(t)},Oe=()=>p===void 0||f===void 0,$e=()=>d===void 0||l&&l.takingRecords.length<=0||l&&l.takingRecords.every(a=>a.takingRecord.isPaid===!0),ze=a=>e.jsxs(W,{className:`detailed-card ${a.takingRecord.isPaid?"paid":""}`,children:[e.jsx(R,{children:e.jsxs(P,{className:"card-header",children:[e.jsx(u,{children:e.jsxs(P,{gap:"15px",alignItems:"center",children:[e.jsx(Pa,{children:e.jsx(Sa,{name:s==null?void 0:s.username})}),e.jsx(k,{children:s==null?void 0:s.username})]})}),a.takingRecord.isPaid?e.jsx(_,{size:"lg",colorPalette:"green",children:"Terbayar"}):e.jsx(_,{size:"lg",colorPalette:"red",children:"Belum Terbayar"})]})}),e.jsx(B,{children:e.jsxs(P,{justifyContent:"space-between",children:[e.jsxs(M,{children:[e.jsx(k,{children:m(a.takingRecord.takenDate)}),e.jsx(k,{children:m(a.takingRecord.takenDate,"p")}),e.jsx(k,{children:j(a.price.price)})]}),e.jsxs(M,{justifyItems:"center",children:[e.jsx(u,{size:"4xl",children:a.takingRecord.amount}),e.jsx(k,{textStyle:"xl",children:"Ampas"})]})]})})]}),He=()=>{const a=l==null?void 0:l.customers.find(t=>t.id===(s==null?void 0:s.id));return e.jsx(e.Fragment,{children:K&&a!==void 0&&e.jsxs(v,{children:[e.jsxs(O,{children:[x("Nama",`${a.username}`),x(`${a.money>=0?"Memiliki Uang ":"Kekurangan Uang "} Sebesar: `,`${j(a.money)}`)]}),e.jsxs(u,{children:["Catatan Ambil Tahun ",d==null?void 0:d.getFullYear()," ","(Total ",K.map(t=>t.amount).reduce((t,i)=>t+i,0),")"]}),e.jsx(z,{children:e.jsxs(ce,{size:"sm",children:[e.jsx(de,{children:e.jsxs(H,{children:[e.jsx(b,{children:"Date"}),e.jsx(b,{children:"Amount"}),e.jsx(b,{children:"Harga Satuan"}),e.jsx(b,{children:"Harga Ambil"})]})}),e.jsx(he,{children:K.map(t=>{var i,D;return e.jsxs(H,{children:[e.jsx(C,{children:m(t.takenDate)}),e.jsx(C,{children:t.amount}),e.jsx(C,{children:j(((i=U.find(V=>V.id===t.priceId))==null?void 0:i.price)??0)}),e.jsx(C,{children:j((((D=U.find(V=>V.id===t.priceId))==null?void 0:D.price)??0)*t.amount)})]},t.id)})})]})})]})})},Ne=()=>e.jsx(e.Fragment,{children:l!==void 0&&e.jsxs(z,{title:"Catatan",minHeight:"700px",children:[l.takingRecords.length<=0&&e.jsx("b",{children:"Data Kosong"}),l.takingRecords.length>0&&l.takingRecords.map((a,t)=>e.jsx(te.Fragment,{children:ze(a)},t))]})}),Ee=()=>e.jsx(z,{minHeight:"70vh",children:Re.map((a,t)=>e.jsx(te.Fragment,{children:e.jsx(oe,{user:s,month:a})},t))}),Le=()=>e.jsx(v,{children:e.jsx(oe,{user:s,month:d})}),Ye=()=>e.jsxs(v,{children:[e.jsxs(P,{justifyContent:"space-between",children:[e.jsxs(M,{width:"100%",children:[e.jsx(u,{children:"Dari Bulan"}),e.jsx("label",{children:e.jsx(q,{placeholderText:"Bulan Dan Tahun",dateFormat:"MMMM yyyy ",selected:f,onChange:a=>Ie(a),showMonthYearPicker:!0,locale:"id",withPortal:!0,open:Te,onClickOutside:()=>L(!1),onInputClick:()=>L(!0)})})]}),e.jsxs(M,{width:"100%",children:[e.jsx(u,{children:"Sampai Bulan"}),e.jsx("label",{children:e.jsx(q,{placeholderText:"Bulan Dan Tahun",dateFormat:"MMMM yyyy ",selected:p,onChange:a=>Ae(a),showMonthYearPicker:!0,locale:"id",withPortal:!0,open:De,onClickOutside:()=>Y(!1),onInputClick:()=>Y(!0)})})]})]}),!h&&f&&p&&e.jsxs(u,{children:["Tidak ada data dari ",m(f,"MMMM yyyy")," hingga ",m(p,"MMMM yyyy")]}),f&&p&&h&&e.jsxs(P,{children:[e.jsxs(W,{children:[e.jsx(R,{children:e.jsxs(u,{children:["Informasi ",m(h.from,"MMMM yyyy")," ","Hingga"," ",m(h.to,"MMMM yyyy")]})}),e.jsx(B,{children:e.jsxs(P,{children:[e.jsxs(M,{children:[e.jsx(R,{children:e.jsx(u,{children:"Total Ambil"})}),e.jsx(B,{children:e.jsxs(O,{children:[x("Total",`${h.detailInformation.totalAmount} Ampas`),x("Terbayar",`${h.detailInformation.paidAmount} Ampas`),x("Belum Terbayar",`${h.detailInformation.unpaidAmount} Ampas`)]})})]}),e.jsxs(M,{children:[e.jsx(R,{children:e.jsx(u,{children:"Tagihan"})}),e.jsx(B,{children:e.jsxs(O,{children:[x("Total",`${j(h.detailInformation.totalBill)}`),x("Terbayar",`${j(h.detailInformation.paidBill)}`),x("Belum Terbayar",`${j(h.detailInformation.unpaidBill)}`)]})})]})]})}),e.jsx(xe,{children:e.jsxs(je,{onClick:()=>Fe(),disabled:Oe(),children:["Bayar ",m(h.from,"MMMM yyyy")," ","Hingga"," ",m(h.to,"MMMM yyyy")]})})]}),we()]})]}),Ke=()=>Z&&l&&d&&e.jsxs(W,{size:"lg",children:[e.jsx(R,{children:e.jsx(u,{children:e.jsxs(P,{alignItems:"center",children:["Informasi Bulan ",m(d,"MMMM yyyy")]})})}),e.jsxs(P,{children:[e.jsxs(M,{children:[e.jsx(R,{children:e.jsx(u,{children:"Total Ambil"})}),e.jsx(B,{children:e.jsxs(O,{children:[x("Total",`${l.detailInformation.totalAmount} Ampas`),x("Terbayar",`${l.detailInformation.paidAmount} Ampas`),x("Belum Terbayar",`${l.detailInformation.unpaidAmount} Ampas`)]})})]}),e.jsxs(M,{children:[e.jsx(R,{children:e.jsx(u,{children:"Tagihan"})}),e.jsx(B,{children:e.jsxs(O,{children:[x("Total",`${j(l.detailInformation.totalBill)}`),x("Terbayar",`${j(l.detailInformation.paidBill)}`),x("Belum Terbayar",`${j(l.detailInformation.unpaidBill)}`)]})})]})]}),e.jsx(xe,{children:e.jsxs(je,{size:"2xl",onClick:()=>Be(),disabled:$e(),children:["Bayar Bulan ",d&&ra(d,"MMMM yyyy",{locale:ue})]})})]}),x=(a,t)=>e.jsxs(Xe,{children:[e.jsx(Ze,{children:e.jsx(k,{textStyle:"lg",fontWeight:"bold",children:a})}),e.jsx(ea,{children:e.jsx(k,{textStyle:"lg",fontWeight:"bold",children:t})})]});return e.jsx("div",{className:"make-payment-page",children:e.jsxs(v,{direction:"row",className:"detailed-info-container",children:[e.jsxs(v,{className:"left-container",children:[e.jsx(u,{fontSize:"2xl",children:"Pilih Nama"}),e.jsxs(da,{size:"lg",value:s?[s.id.toString()]:[],collection:ae,onValueChange:a=>{a.value[0]!==void 0&&X(S.find(t=>t.id===Number(a.value[0])))},children:[e.jsx(ha,{}),e.jsx(ma,{children:e.jsx(ua,{textStyle:"4xl",children:e.jsx(xa,{textStyle:"4xl",placeholder:"Pilih Nama"})})}),e.jsx(na,{children:e.jsx(ja,{children:e.jsx(ga,{children:ae.items.map(a=>e.jsxs(fa,{item:a,children:[e.jsx(k,{textStyle:"lg",children:a.label}),e.jsx(pa,{})]},a.value))})})})]}),e.jsx(u,{fontSize:"2xl",children:"Pilih Bulan dan Tahun"}),e.jsx("label",{children:e.jsx(q,{placeholderText:"Bulan Dan Tahun",dateFormat:"MMMM yyyy ",selected:d,onChange:a=>ve(a),showMonthYearPicker:!0,locale:"id",withPortal:!0,open:ke,onClickOutside:()=>E(!1),onInputClick:()=>E(!0)})}),Ke()]}),Z&&l!==void 0&&e.jsx(M,{className:"tabs-container",children:e.jsxs(ne,{value:Pe,onValueChange:a=>Se(a.value),defaultValue:"Kalender",children:[e.jsxs(se,{children:[e.jsxs(I,{fontSize:"xl",value:"Kalender",children:[e.jsx(G,{}),"Kalender"]}),e.jsxs(I,{fontSize:"xl",value:"Daftar Ambil",children:[e.jsx(ka,{}),"Daftar Ambil"]}),e.jsxs(I,{fontSize:"xl",value:"Informasi Pelanggan",children:[e.jsx(Ta,{}),"Informasi Pelanggan"]}),e.jsxs(I,{fontSize:"xl",value:"Kalendar Satu Tahun",children:[e.jsx(G,{}),"Kalendar Satu Tahun"]}),e.jsxs(I,{fontSize:"xl",value:"Informasi Beberapa Bulan",children:[e.jsx(G,{}),"Informasi Beberapa Bulan"]})]}),e.jsx(A,{value:"Kalender",children:Le()}),e.jsx(A,{value:"Daftar Ambil",children:Ne()}),e.jsx(A,{value:"Informasi Pelanggan",children:He()}),e.jsx(A,{value:"Kalendar Satu Tahun",children:Ee()}),e.jsx(A,{value:"Informasi Beberapa Bulan",children:Ye()})]})})]})})});export{st as default};
