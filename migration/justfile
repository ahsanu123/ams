# NOTE: 
# Manual run: 
# - just delete-old-entity 
# - just delete-database-file
# - comment ams_entity in cargo.toml 
# - comment seed in lib.rs 
# - run just run 
# - just gen-entity 
# - uncomment ams_entity in cargo.toml 
# - uncommnet seed in lib.rs
# - run just run with seed enabled

# run migration and seed data
mig-and-seed:
  echo "todo"

# migrate and generate entity
mage:
  just delete-database-file
  just run 
  just delete-old-entity
  just gen-entity

delete-old-entity: 
  find ./../entity/ -type f \
    ! -name 'Cargo.toml' \
    ! -name 'Cargo.lock' \
    ! -name '.gitignore' \
    -delete

# will run migration up
run: 
  RUST_BACKTRACE=1 cargo run

gen-entity:
  DATABASE_URL=sqlite://../app/src-tauri/ams.sqlite?mode=rwc \
      sea-orm-cli generate entity  -o ./../entity/ \
      --lib --with-serde both \
      --model-extra-derives 'utoipa::ToSchema' \
      --model-extra-attributes 'serde(rename_all = "camelCase")'

delete-database-file:
  rm ../app/src-tauri/ams.sqlite

copy-to-api: 
  cp ../app/src-tauri/ams.sqlite ../api/
