# NOTE: 
# New Flow 
# - delete-database-file
# - run establish_database.rs
# - delete-old-entity
# - gen-entity 
# - run seed_database.rs
# - copy database to api folder

# run migration and seed data
mig-and-seed:
  echo "todo"

# migrate and generate entity
mage:
  just delete-database-file
  cargo run --bin establish_database
  just delete-old-entity
  just gen-entity
  cargo run --bin seed_database
  just copy-to-api

delete-old-entity: 
  find ./../entity/ -type f \
    ! -name 'Cargo.toml' \
    ! -name 'Cargo.lock' \
    ! -name '.gitignore' \
    -delete

# will run migration up
run: 
  RUST_BACKTRACE=1 cargo run

gen-entity:
  DATABASE_URL=sqlite://../app/src-tauri/ams.sqlite?mode=rwc \
      sea-orm-cli generate entity  -o ./../entity/ \
      --lib --with-serde both \
      --model-extra-derives 'utoipa::ToSchema' \
      --model-extra-attributes 'serde(rename_all = "camelCase")'

delete-database-file:
  rm ../app/src-tauri/ams.sqlite

copy-to-api: 
  cp ../app/src-tauri/ams.sqlite ../api/

# binary list 
bl: 
  cargo run --bin
